let d=null;const m=["mousedown","mouseup","pointerdown","pointerup","touchstart","touchend"],g=e=>{e.stopPropagation(),e.preventDefault()};function h(){const e=document.createElement("style");e.id="dynamic-img-hover",e.textContent=`
	  img {
	  	cursor: crosshair !important;
	  }
	  img:hover {
	  	box-shadow: 0 0 1px 1px red !important;
		z-index: 99999 !important; 
		transition: all 0.3s; 
	  }
	`,document.head.appendChild(e)}function p(){const e=document.getElementById("dynamic-img-hover");e&&e.remove()}const c=async e=>{e.stopPropagation(),e.preventDefault();const a=e.target;if(a.tagName==="IMG"){d=await f(a.src);const t=document.createElement("div");t.style.position="fixed",t.style.top="20px",t.style.right="20px",t.style.padding="8px 16px",t.style.backgroundColor="#f8f9fa",t.style.border="2px solid #333",t.style.borderRadius="9999px",t.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",t.style.zIndex="10000",t.style.fontSize="18px",t.style.fontWeight="bold",t.textContent="image copied to extention",document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},3e3),p(),c&&document.removeEventListener("click",c),chrome.runtime.sendMessage({action:"imageSelected"})}};chrome.runtime.onMessage.addListener((e,a,t)=>{console.log("content.js received message",e),e.action==="enableImageSelect"&&(h(),m.forEach(n=>{document.addEventListener(n,g)}),document.addEventListener("click",c)),e.action==="disableImageSelect"&&(p(),d=null,c&&(document.removeEventListener("click",c),m.forEach(n=>{document.removeEventListener(n,g)}))),e.action==="enableTextSelect"&&(d=null)});chrome.runtime.onMessage.addListener((e,a,t)=>{var n;if(console.log("content.js received message",e),e.action==="getSelectedContent"){let o;const i=(n=window.getSelection())==null?void 0:n.toString();d?o={image:d}:i&&(o={text:i}),t(o)}});function f(e){return new Promise((a,t)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let o=n.width,i=n.height;const s=512;(o>s||i>s)&&(o>i?(i=Math.round(i*(s/o)),o=s):(o=Math.round(o*(s/i)),i=s));const r=document.createElement("canvas");r.width=o,r.height=i;const l=r.getContext("2d");if(!l){t(new Error("Could not get canvas context"));return}l.drawImage(n,0,0,o,i);const u=r.toDataURL("image/jpeg");a(u)},n.onerror=()=>{t(new Error("Failed to load image"))},n.src=e})}
